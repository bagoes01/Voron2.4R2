##===========================================================================
##============================= Getting Started =============================
##============================= VORON, V2.4 Rev2 ============================
##===========================================================================
    # This file contains common pin mappings for the BIGTREETECH Octopus
    # V1.1. To use this config, the firmware should be compiled for the
    # STM32F446.

    # See docs/Config_Reference.md for a description of parameters.

    # The "make flash" command does not work on the Octopus V1.1. Instead,
    # after running "make", copy the generated "out/klipper.bin" file to a
    # file named "firmware.bin" on an SD card and then restart the Octopus 
    # V1.1 with SD card.

    # The configuration is very specific for heavily modified VORON V-2.4r2.
    # Use it as reference to set up your printer.
    
    # RS, 2022 - VORON V2.4r2, BIGTREETECH Octopus V1.1 STM32F446
##=================================== End ===================================

##===========================================================================
##============================== Include Files ==============================
##===========================================================================
[include macros.cfg]
[include printer/stepper.cfg]
[include printer/extruder.cfg]
[include printer/fans.cfg]
[include printer/probe.cfg]
[include printer/sensors.cfg]
[include klicky-probe.cfg]
[include auto_z_calibration.cfg]
[include bed_mesh.cfg]
[include sb_leds.cfg]
[include nevermore.cfg]
[include custom_gcode.cfg]
[include fluidd.cfg]
[include menu.cfg]
[include telegram.cfg]
##=================================== End ===================================

##===========================================================================
##============================ MCU Configuration ============================
##===========================================================================
##------------------- BIGTREETECH Octopus V1.1, STM32F446 -------------------
[mcu]
##--------------------------------------------------------------------
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_350063000651303431333234-if00
restart_method: command
##------------------------------ RaspberryPi 4b -----------------------------
[mcu rpi]
serial: /tmp/klipper_host_mcu
##=================================== End ===================================

##===========================================================================
##=========================== Misc. Configuration ===========================
##===========================================================================
[gcode_arcs]
resolution: 0.1

[exclude_object]

[display_status]

[virtual_sdcard]
path: /home/pi/gcode_files
##=================================== End ===================================

##===========================================================================
##=========================== Firmware Retraction ===========================
##===========================================================================
[firmware_retraction]
retract_length: 1.2
retract_speed: 120
unretract_extra_length: 0
unretract_speed: 120
##=================================== End ===================================

##===========================================================================
##========================== Printer Configuration ==========================
##===========================================================================
[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 10000
max_z_velocity: 50
max_z_accel: 500
max_accel_to_decel: 5000
square_corner_velocity: 8.0
##--------------------------------- Command ---------------------------------
[gcode_macro _PRINTER_RESET]
gcode:
    _TEXT MSG="Reset" OUTPUT_TARGET=0

    G92 E0
    M220 S100
    M221 S100
    SET_VELOCITY_LIMIT VELOCITY=500
    SET_VELOCITY_LIMIT ACCEL=8000
    #SET_VELOCITY_LIMIT ACCEL_TO_DECEL=
    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=8.0
    BED_MESH_CLEAR
    SET_GCODE_OFFSET Z=0
##=================================== End ===================================

##===========================================================================
##======================= Input Shaping Configuration =======================
##===========================================================================
##--------------------------------- ADXL345 ---------------------------------
[adxl345]
cs_pin: rpi:None
##---------------------------------------------------------------------------
[resonance_tester]
accel_chip: adxl345
probe_points:
    175, 175, 30      # Center
max_smoothing: 0.050
##----------------------------------- Data ----------------------------------
[input_shaper]
#shaper_freq_x: 53.4     # Max Acceleration : 11100
#shaper_type_x: mzv
#shaper_freq_y: 53     # Max Acceleration : 10900
#shaper_type_y: mzv
##=================================== End ===================================


##===========================================================================
##========================== Heat Bed Configuration =========================
##===========================================================================
[heater_bed]
heater_pin: PA1
max_power: 0.7
sensor_type: Generic 3950
sensor_pin: PF3
#control: pid
#pid_kp: 36.703
#pid_ki: 1.295
#pid_kd: 260.131
min_temp: 0
max_temp: 115
##=================================== End ===================================


##===========================================================================
##================================= DISPLAY =================================
##===========================================================================
##============================= EXP1 | EXP2 Pins ============================
[board_pins]
aliases:
##------------------------------- EXP1 Header -------------------------------
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,
##------------------------------- EXP2 Header -------------------------------
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>
##================================= DISPLAY =================================
[display]
lcd_type: uc1701
cs_pin: EXP1_3
a0_pin: EXP1_4
rst_pin: EXP1_5
encoder_pins: ^EXP2_5, ^EXP2_3
click_pin: ^!EXP1_2
contrast: 63
spi_software_miso_pin: EXP2_1
spi_software_mosi_pin: EXP2_6
spi_software_sclk_pin: EXP2_2
##=============================== DISPLAY RGB ===============================
[neopixel _btt_mini12864]
pin: EXP1_6
chain_count: 3
initial_RED: 1
initial_GREEN: 1
initial_BLUE: 1
color_order: RGB
##---------------------------------------------------------------------------
[delayed_gcode setdisplayneopixel]
initial_duration: 1
gcode:
    SET_LED LED=_btt_mini12864 RED=0.03 GREEN=0.03 BLUE=0.03 INDEX=1 TRANSMIT=0
    SET_LED LED=_btt_mini12864 RED=0.03 GREEN=0.03 BLUE=0.03 INDEX=2 TRANSMIT=0
    SET_LED LED=_btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=3
##=================================== End ===================================

##===========================================================================
##================================ LED Light ================================
##===========================================================================
#[output_pin Caselight]
#pin: PA3
#pwm: False
#value: 1.0
#shutdown_value: 0.0
##--------------------------------- Command ---------------------------------
#[gcode_macro _LIGHTS_OFF]
#gcode:
#    SET_PIN PIN=Caselight VALUE=0.0

#[gcode_macro _LIGHTS_ON]
#gcode:
#    SET_PIN PIN=Caselight VALUE=1.0
##=================================== End ===================================

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh stock]
#*# version = 1
#*# points =
#*# 	0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000
#*# 	0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000
#*# 	0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000
#*# 	0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000
#*# 	0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000
#*# 	0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000
#*# 	0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000
#*# 	0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000
#*# 	0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000
#*# tension = 0.1
#*# min_x = 20.0
#*# algo = bicubic
#*# y_count = 9
#*# mesh_y_pps = 2
#*# min_y = 20.0
#*# x_count = 9
#*# max_y = 300.0
#*# mesh_x_pps = 2
#*# max_x = 330.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.040000, -0.006250, -0.058750, -0.012500, -0.050000, -0.028750, -0.031250, -0.027500, -0.053750
#*# 	-0.015000, 0.025000, 0.003750, -0.001250, 0.018750, -0.037500, -0.021250, -0.013750, -0.027500
#*# 	0.016250, -0.011250, -0.003750, 0.008750, 0.018750, -0.015000, -0.037500, -0.015000, -0.018750
#*# 	-0.007500, 0.003750, 0.010000, -0.030000, 0.001250, 0.002500, -0.027500, -0.020000, -0.012500
#*# 	-0.017500, -0.025000, -0.026250, -0.038750, 0.000000, -0.061250, -0.026250, -0.011250, -0.053750
#*# 	-0.031250, -0.016250, -0.045000, -0.056250, -0.047500, -0.047500, -0.068750, -0.058750, -0.067500
#*# 	-0.023750, 0.010000, -0.021250, -0.017500, -0.017500, -0.020000, -0.035000, -0.027500, -0.035000
#*# 	-0.003750, -0.030000, -0.026250, -0.033750, -0.033750, -0.038750, -0.028750, -0.026250, -0.072500
#*# 	-0.015000, 0.002500, -0.002500, -0.007500, 0.001250, -0.011250, -0.001250, -0.012500, -0.033750
#*# tension = 0.1
#*# min_x = 20.0
#*# algo = bicubic
#*# y_count = 9
#*# mesh_y_pps = 2
#*# min_y = 20.0
#*# x_count = 9
#*# max_y = 300.0
#*# mesh_x_pps = 2
#*# max_x = 330.0
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 64.2
#*# shaper_type_y = mzv
#*# shaper_freq_y = 64.2
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 19.058
#*# pid_ki = 1.296
#*# pid_kd = 70.039
#*#
#*# [stepper_z]
#*# position_endstop = 0.280
#*#
#*# [probe]
#*# z_offset = -0.325
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 36.439
#*# pid_ki = 1.446
#*# pid_kd = 229.565
